
<!DOCTYPE html>
<html lang="en" style="width:1100px; height:700px; margin:0 auto;">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.11.0/qs.min.js" integrity="sha512-/l6vieC+YxaZywUhmqs++8uF9DeMvJE61ua5g+UK0TuHZ4TkTgB1Gm1n0NiA86uEOM9JJ6JUwyR0hboKO0fCng==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        #container{
            width:100%;
            height:100%;
            margin:0 auto;
        }
        #topContainer{
            width: 100%;
            height:90%;

        }
    </style>
    
</head>

<!--
<iframe width="560" height="315" src="https://www.youtube.com/embed/IAMdPn3YCG4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

-->

<body style="width:100%; height:100%; margin:0 auto;">
    <div id="container">
        <div id="topContainer">
            <iframe onclick="setRateInterval()" width="100%" height="100%" src="<%= datas.videoUrl %>" sandbox="allow-forms allow-scripts allow-same-origin"></iframe>
        </div>
        <input type="hidden" id="watchDate" name="watchDate" value="<%= datas.watchDate %>"/>
        <input type="hidden" id="watchTime" name="watchTime" value="<%= datas.watchTime %>"/>
        <input type="hidden" id="watchComplete" name="watchComplete" value="<%= datas.watchComplete %>"/>
        <input type="hidden" id="videoName" name="videoName" value="<%= datas.videoName %>"/>
        <div id="bottomContainer">
            <input type="button" value="나가기"/>
        </div>
    </div>    
</body>


<script>
    function setRateInterval(){
        
        var totalCurrentTime;
        var totalCurrentTimeToSec;
        var currentTime;

        var timeCnt = document.getElementById("watchTime").value;
        var data = {
            userId : JSON.parse(localStorage.getItem('UserInfo')).userid,
            videoName : document.getElementById("videoName").value,
            watchDate : document.getElementById("watchDate").value,
            watchTime : timeCnt,
            watchComplete : document.getElementById("watchComplete").value
        };

        setInterval(()=>{
            totalCurrentTime = document.getElementsByClassName("ytp-time-current").innerText;
            totalCurrentTimeToSec = (totalCurrentTime.split(":")[0] * 60) + totalCurrentTime.split(":")[1];

            console.log(`totalCurrentTime : ${totalCurrentTime}`);
            console.log(`totalCurrentTimeToSec : ${ totalCurrentTimeToSec }`);


            if ( totalCurrentTimeToSec > (data["watchTime"] + 3) ) {
                document.getElementsByClassName("ytp-time-current").innerText = `${ parseInt(data["watchTime"] / 60) +":"+ data["watchTime"] % 60 }`;
            } else {
                data["watchTime"] = (totalCurrentTime.split(":")[0] * 60) + totalCurrentTime.split(":")[1];
            }

            //var currentTime = document.getElementsByClassName("ytp-time-current").innerText;
            //console.log(`currentTime : ${currentTime}`);
            

            if ( timeCnt++ % 2 == 0 ) {
                data["watchTime"] = timeCnt;
                axios({
                    url: 'web/util/saveVideoLog',
                    method: 'POST',
                    baseURL: `http://220.67.231.91:80`,
                    data: Qs.stringify(data)
                }).then((res) => { // 로그인 성공하면
                    console.log(res);
                });
                //axios 끝
            }
        },1000);
    }
</script>

</html>
