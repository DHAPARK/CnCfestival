<!DOCTYPE html>
<html lang="en" style="height:1700px;">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="/market.css"/>

    <style>

        .videoSemiContainer{
            width : 100%;
            height : 100%;
        }

        .videoSpace{
            width : 100%;
            height : 100%;
            display:grid;
            grid-template-columns: 33% 33% 33%;
            grid-column-gap: 10px;
            grid-row-gap: 1em;
        }
        .eachVideo{
            margin: 20px;
        }

    </style>

    <script>
        function goToBack(element) {
            var currentPage = element.parentNode.parentNode.children[0].innerText;
            console.log(`현재 페이지는 ${currentPage}`);
            if (currentPage > 1) {
                var backPage = currentPage - 1;
                location.href = 'http://220.67.231.91:80/web/market?page=${backPage}';
            }
        }

        function viewChildPage(element){
            //obj.style.display = 'none';
            //console.log(element);
            var _eleChild = element.children[0];
            var eleChild = element.children[1].children;

            //console.log(element.innerHTML);
            var UserInfo = JSON.parse(localStorage.getItem('UserInfo'));
            
            console.log(`제품명 ${eleChild[0].innerText}`);
            console.log(`코인수량 ${eleChild[1].innerText.substring(0,eleChild[1].innerText.length-4)}`);
            console.log(`상대지갑주소 ${eleChild[3].value}`);
            console.log(`description : ${eleChild[2].value}`);
            console.log(`내지갑주소 ${UserInfo.accountAddress}`);
            console.log(`비번 ${UserInfo.userpw}`);
            console.log(`아이디 ${UserInfo.userid}`);
            var userid = UserInfo.userid;
            var userpw = UserInfo.userpw;
            var senderAddress = UserInfo.accountAddress;
            var description = eleChild[2].value;
            var receiverAddress = eleChild[3].value;
            var productName = eleChild[0].innerText;
            var amount = eleChild[1].innerText.substring(0,eleChild[1].innerText.length-4);
            var image = _eleChild.src;
            console.log(`image: ${image}`);

            var myWindow = window.open(`http://220.67.231.91:80/web/marketChild?userid=${userid}&userpw=${userpw}&senderAddress=${senderAddress}&description=${description}&receiverAddress=${receiverAddress}&productName=${productName}&amount=${amount}&image=${image}`,"구매창","width=800px,height=1200px");
        }
    </script>
</head>
<body>


    
    
    <div id="container">
        <!-- 맨위 왼쪽의 로고와 오른쪽의 메뉴들을 담는 topcontainer -->
        <div id="topLongContainer" class="bg_cont">
            
            <div id="topLongContainerInnerLeftLogoImg" class="bg_cont">
                <img id="topLongContainerInnerLeftLogoImg_Img" src="/webimg/HSC_mini.png"/>
            </div>
            <!--topLongContainerInnerLeftLogoImg 끝-->
            <!-- 맨위 오른쪽 메뉴들 (홈페이지, 로그인/회원가입 , 학습 , 메뉴 등-->
            <div id="topLongContainerInnerRightMenuList" class="bg_cont">
                <a href="http://220.67.231.91:80/web/introduce">홈페이지</a>
                <a href="http://220.67.231.91:80/web/market">제휴 스토어</a>
                <a href="http://220.67.231.91:80/web/menuList">학습</a>
                <a href="http://220.67.231.91:80/web/mypage" id="myPage">My page</a>
            </div>
            <!--topLongContainerInnerRightMenuList 끝-->
        </div>
        <!-- topLongContainer 끝 -->

        <div id="contentsContainer">

            <!--"동영상 강의" 텍스트 들어갈 자리-->
            <div id="topText">
                <center><p id="topTextInnerText">상점</p></center>
            </div>
            <!--topText 끝-->

            <div id="videoContainer">

                <!-- grid 레이아웃으로 video 정렬하면 될것같은데 -->
                <div class="videoSemiContainer">
                    <!-- 결론적으로 비디오를 받아오면 videoSpace를 for문 돌리게될듯
                    videosemicontainer도 2중 for로 돌릴라나..-->
                    <div class="videoSpace">
                        <% for ( let i=0;i< marketInfo.length ; i++){ %>
                        <div class="eachVideo" onclick="viewChildPage(this);">
                            <!-- 여기에 이미지 -->
                            <!--<img src="https://storage.googleapis.com/hscoin-d8ff7.appspot.com/test_img1.jpeg?GoogleAccessId=firebase-adminsdk-unmpe%40hscoin-d8ff7.iam.gserviceaccount.com&Expires=1913382000&Signature=sko1Qjgr0C33aLV86%2BYZ4ny1qbfEILl9iaxWyymnXf2nfZHB7G%2FIcf6oSiW2lXLRXRgqo0l7EYWR%2FijTOM1C0bKeMpWwncsNJ0bs3q35EHzgNPmqnIfuAUJ53IF1xGs3Y4wlooLZHqBxT5a0D8jJVPWVjygesWQdykufKFdSnwYGNXVQTsk9PXfVYgDKFIGJ6RVyvibdVA3jgGJvCScrTwX4dV%2B0xMPF%2B%2BRkjUtv%2FhxfG4zPeScNMKxqWFvo83EPy0c3gJ%2BrmgpAcM58QaF5v2swD%2BjSb5hmb4wMTZlks4paNYI%2BTO%2FDb6%2BfskvqDGWDzGtbLrBr4%2B9lg3MA3qzi5g%3D%3D" style="width:100%; height:100%;"/>-->
                            <img src="<%=marketInfo[i].image%>" style="width:100%;"/> 
                            <center>
                                <p style="margin-bottom: 5px;"><%=marketInfo[i].name%></p>
                                <p><%=marketInfo[i].price%> HSC</p>
                                <!--<p><%=marketInfo[i].description%></p>-->
                                <!--<p><%=marketInfo[i].manufacturer%></p>-->
                                <input type="hidden" name="description" value="<%= marketInfo[i].description %>"/>
                                <input type="hidden" name="manufacturer" value="<%= marketInfo[i].manufacturer %>"/>
                            </center>
                        </div>
                        <!--eachVideo 끝 -->
                        <% } %>
                        
                    </div>
                    <!--videoSpace 끝-->
                </div>
                <!--videoSemiContainer 끝-->
            </div>
            <!-- videoContainer 끝 -->
        </div> 
        <!--contentsContainer 끝-->
    </div>
    <!--container 끝-->
    
    <footer style="width: 100%;">
        <input type="hidden" name="page" value="<%= page %>"/>
        <center style="color: black; font-size: 1.5rem;">
            <span onclick="goToBack(this)"><</span>
            <%
            for(var j = 0; j < totalPage ; j++){
            %>
            <a style="padding: 5px; color: black; font-size: 1.5rem;" href="http://220.67.231.91:80/web/market/<%= j + 1 %>"><%= j + 1 %></a>
            <%
            }
            %>
            <span onclick="goToFront()">></span>
        </center>
    </footer>
</body>
<script>
    document.getElementById("myPage").href = document.getElementById("myPage").href + '/' + `${JSON.parse(localStorage.getItem('UserInfo')).userid}`;
</script>

</html>